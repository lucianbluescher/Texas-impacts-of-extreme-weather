---
title: "Texas Blackout Analysis"
format: pdf
author: "Lucian Scher"
date: "11/8/2025"
editor_options: 
  chunk_output_type: inline
---
GitHub repository: https://github.com/lucianbluescher/Texas-impacts-of-extreme-weather.git

# 1. Load required packages
```{r}
library(stars) # For working with raster data
library(sf) # For loading data with SQL query subset
```


# 2. Read in Data

## Night Lights: 
NASA VIIRS Houston night time light coverage data from sinusoidal equal-area projection tiles h08v05 and h08v06 on 2021-02-07 and 2021-02-16
Key: lights_TILE_DAY
```{r}
# tile h08v05, collected on 2021-02-07 (VNP1038)
lights_05_07 <- read_stars('data/VNP46A1/VNP46A1.A2021038.h08v05.001.2021039064328.tif')

# tile h08v06, collected on 2021-02-07 (VNP1038)
lights_06_07 <- read_stars('data/VNP46A1/VNP46A1.A2021038.h08v06.001.2021039064329.tif')

# tile h08v05, collected on 2021-02-16 (VNP1038)
lights_05_16 <- read_stars('data/VNP46A1/VNP46A1.A2021047.h08v05.001.2021048091106.tif')

# tile h08v06, collected on 2021-02-16 (VNP1038)
lights_06_16 <- read_stars('data/VNP46A1/VNP46A1.A2021047.h08v06.001.2021048091105.tif')
```

```{r}
# Combine night light data by day using st_mosaic

feb_7_comb <- st_mosaic(lights_05_07, lights_06_07)
feb_16_comb <- st_mosaic(lights_05_16, lights_06_16)

# Subtract into a new object to show differences
comb_change <- feb_16_comb - feb_7_comb

# Reclassify data when change is less than a -200 drop (greater than 200 drop) set to 1, if less than 200 drop set as NA
blackout_vals <- ifelse(comb_change[[1]] < -200, 1, NA)

# Wrap back into stars data
blackout_sf <- st_as_stars(blackout_vals, dimensions = st_dimensions(comb_change))

# Convert raster to polygons (sf)
blackout_sf <- st_as_sf(blackout_sf, as_points = FALSE, merge = TRUE, na.rm = TRUE)

# Fix invalid geometries 
blackout_sf <- st_make_valid(blackout_sf)

# Plot result
plot(blackout_sf["X"], main = "Vectorized Blackout Areas")

```


```{r}
st_crop(your_sf_object, xmin = your_xmin, xmax = your_xmax, ymin = your_ymin, ymax = your_ymax)
```


## Roads:
Road data from Open Street Map redistributed by Geofabriks and prepared for Houston Specific analysis by teaching team
```{r}
# Read road data using SQL query specifying highways only
roads_sf <- st_read( "data/gis_osm_roads_free_1.gpkg", 
  query = "SELECT * 
  FROM gis_osm_roads_free_1 
  WHERE fclass='motorway'"
)
```

## Houses
House data also from Open Street Map redistributed by Geofabriks and prepared for Houston Specific analysis by teaching team

```{r}

# Read Houston home data using SQL query specifying only buildings with residents
homes_sf <- st_read("data/gis_osm_buildings_a_free_1.gpkg",
  query = "SELECT *
  FROM gis_osm_buildings_a_free_1
  WHERE (type IS NULL AND name IS NULL)
  OR type in ('residential', 'apartments', 'house', 'static_caravan', 'detached')"
)
```

## Socioeconomic
Socioeconomic data from  U.S. Census Bureauâ€™s American Community Surveys 2019 census tracts
```{r}
#Read in income layere
socio_sf_inc <- st_read('data/ACS_2019_5YR_TRACT_48_TEXAS.gdb',
                    layer = 'X19_INCOME')

# Read in geometry layer
socio_sf_geo <- st_read('data/ACS_2019_5YR_TRACT_48_TEXAS.gdb',
                    layer = 'ACS_2019_5YR_TRACT_48_TEXAS')

# Read in Another layer of socioeconomic information
```

```{r}
st_layers(dsn = 'data/ACS_2019_5YR_TRACT_48_TEXAS.gdb')
```

